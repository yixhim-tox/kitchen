<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leaderboard Admin</title>
<style>
body { font-family: Arial; background: #f2f2f2; padding: 20px; }
h2 { text-align:center; margin-bottom:20px; }
form { background:white; padding:20px; border-radius:10px; margin-bottom:20px; }
input { width:100%; padding:8px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
button { padding:10px 15px; background:red; color:white; border:none; border-radius:5px; cursor:pointer; margin-top:5px; width:100%; }
.rank-section { margin-bottom:20px; background:white; padding:15px; border-radius:10px; }
.rank-label { font-weight:bold; display:block; margin-bottom:5px; }
</style>
</head>
<body>

<h2>Leaderboard Admin</h2>

<div id="leaderboard-form">
  <!-- Ranks 1-3 -->
  <div class="rank-section">
    <h3>Top 3</h3>
    <div>
      <span class="rank-label">1️⃣ Top 1</span>
      <input placeholder="Name" id="top1-name">
      <input placeholder="Plates" id="top1-plates" type="number">
      <input placeholder="Image URL" id="top1-img">
    </div>
    <div>
      <span class="rank-label">2️⃣ Top 2</span>
      <input placeholder="Name" id="top2-name">
      <input placeholder="Plates" id="top2-plates" type="number">
      <input placeholder="Image URL" id="top2-img">
    </div>
    <div>
      <span class="rank-label">3️⃣ Top 3</span>
      <input placeholder="Name" id="top3-name">
      <input placeholder="Plates" id="top3-plates" type="number">
      <input placeholder="Image URL" id="top3-img">
    </div>
  </div>

  <!-- Ranks 4-20 -->
  <div class="rank-section">
    <h3>Ranks 4 - 20</h3>
    <div id="rest-container"></div>
  </div>

  <!-- Save button -->
  <button onclick="saveLeaderboard()">Save Leaderboard</button>
</div>

<script>
const defaultImg = 'https://i.postimg.cc/RFQyqcrR/IMG-20260222-WA0018.jpg';
const restContainer = document.getElementById('rest-container');

// Dynamically create input boxes for ranks 4-20
for(let i=4;i<=20;i++){
  const div = document.createElement('div');
  div.innerHTML = `
    <span class="rank-label">${i}️⃣ Rank ${i}</span>
    <input placeholder="Name" id="rank${i}-name">
    <input placeholder="Plates" type="number" id="rank${i}-plates">
    <input placeholder="Image URL" id="rank${i}-img">
  `;
  restContainer.appendChild(div);
}

// Load existing leaderboard from MongoDB
async function loadLeaderboard(){
  try {
    const res = await fetch('/api/leaderboard');
    const data = await res.json();

    data.forEach(entry => {
      const rank = entry.rank;
      if(rank===1){document.getElementById('top1-name').value=entry.player; document.getElementById('top1-plates').value=entry.score; document.getElementById('top1-img').value=entry.img||'';}
      else if(rank===2){document.getElementById('top2-name').value=entry.player; document.getElementById('top2-plates').value=entry.score; document.getElementById('top2-img').value=entry.img||'';}
      else if(rank===3){document.getElementById('top3-name').value=entry.player; document.getElementById('top3-plates').value=entry.score; document.getElementById('top3-img').value=entry.img||'';}
      else if(rank>=4 && rank<=20){
        document.getElementById(`rank${rank}-name`).value = entry.player;
        document.getElementById(`rank${rank}-plates`).value = entry.score;
        document.getElementById(`rank${rank}-img`).value = entry.img||'';
      }
    });
  } catch(err){
    console.error('Error loading leaderboard:', err);
  }
}

// Save all leaderboard entries to MongoDB
function saveLeaderboard() {
  const entries = [];

  // Top 3
  for(let i=1;i<=3;i++){
    entries.push({
      rank: i,
      player: document.getElementById(`top${i}-name`).value || '',
      score: parseInt(document.getElementById(`top${i}-plates`).value) || 0,
      img: document.getElementById(`top${i}-img`).value || defaultImg
    });
  }

  // Ranks 4-20
  for(let i=4;i<=20;i++){
    const name = document.getElementById(`rank${i}-name`).value;
    const plates = parseInt(document.getElementById(`rank${i}-plates`).value) || 0;
    const img = document.getElementById(`rank${i}-img`).value || defaultImg;
    if(name || plates){
      entries.push({rank: i, player: name, score: plates, img: img});
    }
  }

  fetch('/api/leaderboard', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(entries)
  })
  .then(res => res.json())
  .then(data => alert(data.message))
  .catch(err => alert('Error saving leaderboard: '+err));
}

// Load leaderboard on page load
window.onload = loadLeaderboard;
</script>

</body>
</html>